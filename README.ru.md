# Рой агентов Codex

Рой агентов Codex — это легковесный фреймворк, который соединяет плагин OpenAI Codex с любым IDE, где он установлен. Он рассматривает сессию IDE как кооперативное многоагентное рабочее пространство, позволяя оркестрировать специализированных агентов, которые сотрудничают над задачами от разработки ПО до документации, планирования или исследований.

## Как это устроено

1. **Контракт, ориентированный на оркестратора.** `AGENTS.md` описывает только глобальные правила, общее состояние и агента ORCHESTRATOR. Оркестратор интерпретирует цель пользователя, составляет план, запрашивает одобрение и делегирует работу другим агентам.
2. **Внешний реестр агентов.** Каждый агент, кроме оркестратора, находится в `.AGENTS/<ID>.json`. Когда IDE загружает репозиторий, он динамически импортирует каждый JSON-документ и регистрирует ID агента, его роль, разрешения и рабочий процесс.
3. **Общее состояние задач.** План в формате, удобном человеку, хранится в `PLAN.md`, а машинно-читаемый прогресс — в `.AGENTS/TASKS.json`. Такое разделение позволяет агентам надежно делиться статусом независимо от IDE.
4. **Работа без привязки к плагину.** Поскольку инструкции представлены в виде Markdown и JSON, любой IDE с установленным плагином Codex может выполнять те же сценарии без дополнительной настройки.

## Структура репозитория

```
.
├── AGENTS.md
├── LICENSE
├── PLAN.md
├── README.md
└── .AGENTS/
    ├── PLANNER.json
    ├── CODER.json
    ├── REVIEWER.json
    ├── DOCS.json
    ├── CREATOR.json
    └── TASKS.json
```

| Путь | Назначение |
| --- | --- |
| `AGENTS.md` | Глобальные правила, рабочий процесс коммитов и спецификация ORCHESTRATOR (плюс JSON-шаблон для новых агентов). |
| `.AGENTS/PLANNER.json` | Определяет, как задачи добавляются и обновляются в `PLAN.md` и `.AGENTS/TASKS.json`. |
| `.AGENTS/CODER.json` | Специалист по реализации, отвечающий за правки кода или конфигурации, связанные с ID задач. |
| `.AGENTS/REVIEWER.json` | Выполняет ревью, проверяет работу и меняет статус задач. |
| `.AGENTS/DOCS.json` | Синхронизирует README и другие документы с недавно завершённой работой. |
| `.AGENTS/CREATOR.json` | Фабрика агентов по запросу, которая создаёт новые JSON-агенты и обновляет реестр. |
| `.AGENTS/TASKS.json` | Машинно-читаемое зеркало беклога; является канонической версией при расхождениях. |
| `PLAN.md` | Беклог в Markdown, которым делятся в беседе (разделы Backlog / Done). |
| `README.md` | Обзор и материалы для онбординга по репозиторию. |
| `LICENSE` | Лицензия MIT для проекта. |

## Жизненный цикл агента

1. **Планирование.** ORCHESTRATOR читает `AGENTS.md`, загружает `.AGENTS/*.json` и создаёт план, где каждый шаг закреплён за зарегистрированным агентом (например, PLANNER, CODER, REVIEWER, DOCS).
2. **Одобрение.** Пользователь может одобрить, отредактировать или отменить план до начала работы.
3. **Исполнение.** Оркестратор переключает `agent_mode` согласно плану, позволяя каждому агенту следовать описанному в JSON рабочему процессу внутри IDE.
4. **Отслеживание прогресса.** Агенты обновляют `PLAN.md` и `.AGENTS/TASKS.json` в рамках своих разрешений, чтобы люди и инструменты видели актуальный статус.

Такая структура позволяет собирать любые цепочки действий: реализацию кода, обновление документации, обзоры исследований или трияж задач — и всё это в рамках одной IDE-сессии.

## Рабочий процесс коммитов

- Рабочее пространство всегда находится под git, поэтому каждый значимый апдейт должен попадать в систему контроля версий.
- Каждая атомарная задача из `PLAN.md` соответствует ровно одному коммиту с лаконичным, человекочитаемым сообщением (желательно с упоминанием ID задачи).
- Агент, выполняющий работу, индексирует изменения и коммитит их до передачи управления оркестратору, а оркестратор приостанавливает план, пока коммита нет.
- Сводки по шагам включают новый хеш коммита и подтверждают, что рабочее дерево чистое, чтобы прогресс было удобно проверять прямо из беседы.
- Если шаг плана не приводит к изменениям в файлах, это нужно явно указать; иначе рой не должен двигаться дальше без коммита.

## Детали общего состояния

- **`PLAN.md`**: Markdown-чеклист для людей. Здесь перечислены задачи с ID, секциями (Backlog, In Progress, Done) и чекбоксами состояния. Агенты всегда читают файл целиком перед правками.
- **`.AGENTS/TASKS.json`**: Зеркало для машин со строгой JSON-схемой, чтобы агенты могли детерминированно парсить, фильтровать и обновлять состояние. При расхождениях каноничным считается `.AGENTS/TASKS.json`, поэтому `PLAN.md` нужно приводить к нему.

## Добавление нового агента

1. Скопируйте шаблон из раздела "JSON Template for New Agents" в `AGENTS.md`.
2. Сохраните файл как `.AGENTS/<AGENT_ID>.json`, используя ID в верхнем регистре (например, `RESEARCHER.json`).
3. Заполните `role`, `description`, `inputs`, `outputs`, `permissions` и упорядоченный список `workflow`, описывающий желаемое поведение агента.
4. Сделайте коммит; при следующем запуске оркестратор автоматически загрузит и зарегистрирует нового агента.

Поскольку каждый агент — это чистый JSON, вы можете расширять рой специалистами по QA, маркетингу, техписьму, обработке данных или любым другим процессом, который хотите автоматизировать в IDE.

## Выход за рамки разработки

Хотя Рой агентов Codex отлично справляется с реализацией кода, ничего не мешает агентам заниматься и другими типами задач. Определяя рабочие процессы в JSON, вы можете создавать:

- Исследовательских агентов, которые резюмируют документацию перед кодированием.
- Комплаенс-ревьюеров, проверяющих коммиты на нарушение политик.
- Операционные плейбуки, которые координируют деплой или реагирование на инциденты.
- Ботов-документоводов, поддерживающих changelog и README в актуальном состоянии.

Если плагин OpenAI Codex может добраться до репозитория из вашего IDE, он сможет оркестрировать этих агентов с помощью того же фреймворка.
